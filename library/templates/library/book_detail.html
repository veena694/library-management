{% extends 'library/base.html' %}

{% block content %}
<div style="background: var(--white); border-radius: 20px; padding: 3rem; box-shadow: 0 10px 40px var(--shadow);">
    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 3rem; margin-bottom: 2rem;">
        <div>
            <div style="background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 15px; padding: 4rem 2rem; text-align: center; font-size: 5rem;">
                📕
            </div>
            
            {% if user.is_authenticated %}
            <button onclick="toggleFavorite('{{ book.id }}')" class="favorite-btn {% if is_favorite %}active{% endif %}" style="width: 100%; margin-top: 1rem; padding: 1rem; background: var(--light); border-radius: 10px;">
                {% if is_favorite %}❤️{% else %}🤍{% endif %} Favorite
            </button>
            {% endif %}
            
        </div>
        
        <div>
            <h1 style="font-size: 2.5rem; color: var(--dark); margin-bottom: 1rem;">{{ book.title }}</h1>
            
            <div style="margin-bottom: 1.5rem;">
                {% if book.availability == 'available' %}
                <span class="badge badge-success" style="font-size: 1rem; padding: 0.5rem 1rem;">✓ Available</span>
                {% else %}
                <span class="badge badge-danger" style="font-size: 1rem; padding: 0.5rem 1rem;">✗ {{ book.availability|title }}</span>
                {% endif %}
                <span class="badge badge-primary" style="font-size: 1rem; padding: 0.5rem 1rem;">⭐ {{ book.rating }}/5</span>
                <span class="badge badge-primary" style="font-size: 1rem; padding: 0.5rem 1rem;">👁 {{ book.views }} views</span>
            </div>
            
            <div style="background: var(--light); padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem;">
                <p style="margin-bottom: 0.8rem;"><strong>📝 Authors:</strong> {{ book.authors.all|join:", " }}</p>
                <p style="margin-bottom: 0.8rem;"><strong>🗂 Category:</strong> {{ book.category.name }}</p>
                <p style="margin-bottom: 0.8rem;"><strong>📚 Publisher:</strong> {{ book.publisher|default:"N/A" }}</p>
                <p style="margin-bottom: 0.8rem;"><strong>📅 Year:</strong> {{ book.publication_year|default:"N/A" }}</p>
                <p style="margin-bottom: 0.8rem;"><strong>📄 Pages:</strong> {{ book.pages|default:"N/A" }}</p>
                <p style="margin-bottom: 0.8rem;"><strong>🌐 Language:</strong> {{ book.language }}</p>
                <p style="margin-bottom: 0.8rem;"><strong>📖 ISBN:</strong> {{ book.isbn|default:"N/A" }}</p>
                <p style="margin-bottom: 0;"><strong>📊 Copies:</strong> {{ book.copies_available }} / {{ book.copies_total }} available</p>
            </div>
            
            <div style="margin-bottom: 1.5rem;">
                <h3 style="margin-bottom: 0.5rem;">🏷 Keywords</h3>
                <div>
                    {% for keyword in book.get_keywords_list %}
                    <span class="badge badge-primary" style="margin: 0.25rem;">{{ keyword }}</span>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <div style="margin: 2rem 0;">
        <h2 style="margin-bottom: 1rem;">📖 Description</h2>
        <p style="line-height: 1.8; text-align: justify;">
            {{ book.description|default:"No description available for this book." }}
        </p>
    </div>
    
    {% if reviews %}
    <div style="margin: 3rem 0;">
        <h2 style="margin-bottom: 1rem;">⭐ Reviews</h2>
        {% for review in reviews %}
        <div style="background: var(--light); padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <strong>{{ review.user.username }}</strong>
                <span>{% for i in "12345"|slice:":"|make_list %}{% if forloop.counter <= review.rating %}⭐{% else %}☆{% endif %}{% endfor %}</span>
            </div>
            <p>{{ review.comment }}</p>
            <small style="color: #6b7280;">{{ review.created_at|date:"F d, Y" }}</small>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <div style="text-align: center; margin: 2rem 0;">
        <a href="{% url 'library:search' %}" class="btn btn-outline" style="padding: 1rem 3rem;">← Back to Search</a>
    </div>
</div>

{% if related_books %}
<h2 style="color: white; margin: 3rem 0 1rem; font-size: 2rem;">📚 Related Books</h2>
<div class="card-grid">
    {% for book in related_books %}
    <div class="card fade-in">
        <div class="card-image" style="display: flex; align-items: center; justify-content: center; font-size: 3rem;">
            📘
        </div>
        <div class="card-content">
            <h3 class="card-title">{{ book.title|truncatewords:5 }}</h3>
            <p class="card-text">{{ book.authors.all|join:", "|truncatewords:2 }}</p>
            <a href="{% url 'library:book_detail' book.pk %}" class="btn btn-primary" style="width: 100%; text-align: center;">View Details</a>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}

